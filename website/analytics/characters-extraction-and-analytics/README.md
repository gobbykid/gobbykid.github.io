---
description: >-
  In this page, the process of character extraction is described first, while
  limitations and possible errors are listed at the end.
---

# Characters extraction and analytics

A first analysis focuses on the presence of male and female characters in the stories told by Victorian books for children. In particular, the aim is to search for common patterns in the usage of characters by male and female authors, and how this usage varies through time.

{% embed url="https://github.com/gobbykid/gobbykid-characters-extraction.git" %}
The GitHub repository holding the Python files and Notebooks used for both extracting charcaters' information and processing the data.
{% endembed %}

## Workflow, functions and limitations

The Python functions developed to extract the characters' names from the corpus of books are organized in two main files:

* `charEx.py` consists in the functions used to process the text and to perform the [Named Entity Recognition](https://en.wikipedia.org/wiki/Named-entity\_recognition) in order to store the characters' names into a set that is then processed by the functions contained into the `genderRec` file.
* `genderRec.py` contains the functions used to process the set of names in order to classify each one with a label expressing the character's gender.

### `charEx.py`

The Natural Language Processing tasks needed for the characters' extraction have been performed by using more than one library. In particular, after having compared the performances of [NLTK](https://www.nltk.org/) and [spaCy](https://spacy.io/) it has been noted that both libraries extracted characters that the other library missed, and different characters that were not really characters. In conclusion, both libraries has been used, and the results have been filtered by means of a more straightforward function that extract proper nouns without performing a proper Named Entity Recognition.

#### The functions

`get_characters` is the main function. It takes a book in input and preprocesses it by removing characters that can influence negatively the segmentation of text into sentences. Then, the book is given as input to three different functions that independently segment the text into sentences and tokens to finally extract characters' names. The result of each extraction is stored into a set. The union of the sets coming from the extraction performed by using NLTK (`get_charaters_nltk`) and spaCy(`get_characters_spacy`) is intersected by the set generated by the `get_proper_nouns` function. However, the set generated by the last function is firstly processed by: 1) maintaining only the words that occur in text with the first letter capitalized and at least once not at the beginning of a sentence and 2) by excluding all the words that may be referred to cities, nationalities, countries, and other similar categories by means of the `check_names` function.

`get_charaters_nltk` and `get_characters_spacy` perform the Named Entity Recognition. Naturally, only the entities identified as “PERSON” have been included in the final set. Under this label also names of “animal characters” have been included. The Named Entity Recognition, however, is not a precise task, so into the set also names referred to entities that are not characters are included. We demand the explanation of the technical procedure used by the two libraries in order to extract the entities' names to their documentations linked above.

`get_proper_nouns` aims at providing information related to the probability of a word being a character name or surname. In particular, each word of the text is stored into a dictionary with the count of times in which it occurred with the first letter capitalized, in lowercase, and not at the beginning of a sentence. The keys are stored in the dictionary not always as single words, but, in cases in which a full name is present into the text (e.g., John Doe) the full occurrence is considered instead. In this way, the names should match the ones extracted by the other functions. The segmentation of the text in sentences is done by means of the`syntok_list_of_sentences` function, in which the [Syntok segmenter](https://github.com/fnl/syntok) is used.

{% embed url="https://github.com/gobbykid/gobbykid-characters-extraction/blob/main/characters_extraction_and_gender_recognition/charEx.py" %}
The charE.py file
{% endembed %}

### `genderRec.py`

Also for the gender recognition two different libraries has been used: [genderComputer](https://github.com/tue-mdse/genderComputer) and [Gendrize](https://github.com/SteelPangolin/genderize).

Genderize is capable of determining the gender of some names that genderComputer is not able to classify. However, it works only through requests made to an API and has a daily limit of 1000 requests. Two solutions have been found to overcome this problem. The first consists in using another library (genderComputer) to recognize names' gender, and using Genderize only for the cases in which the first library cannot assign a label with certainty. With few books, this solution is valid. However, with more than 200 texts, the daily limit of Genderize is still exceedable. The second consists in extracting the names from the corpus more than once and, at each iteration of the code execution, to store the already classified names into two different CSV file (one for male and on for female characters). These files are used in the iterations of the execution in order to check whether the names extracted from the book have been already classified as female or male without using the methods provided by the libraries. At each iteration, the files are updated. Moreover, we decided to execute the extraction on the split corpus (male author's corpus and female author's corpus) by two different computers in order to accelerate the process (that is why there are more than one `get_characters` files in the repository). Naturally, each iteration occurred at different times (one per day for each sub-corpus) due to the fact that the request limitation resets on a daily basis.

#### The functions

The function `gender_recognition` tries to identify the gender of each name contained in the set it takes in input (in this case, the one extracted by the functions of the previous file). In the set, names can be composed by a single or by multiple words. Nevertheless, while Genderize is able to work with full names, genderComputer works only with single-words names.

Before approaching the proper gender recognition, the names are firstly divided into two lists and the single-word names that are most likely to be surnames are removed. This step is done on the basis of a comparison between the single-word names and the multiple-words ones by executing the `filter_surnames` function. It basically removes the names that are composed by a single word, but are also present in the list of names composed by multiple words at the last index of the name. Thus, a first attempt is done to recognize the gender of a character by looking at “gendered words” in the name such as “Miss”, “Mr”, etc. If it is not possible, genderComputer try to classify the single-word names, while the multiple-words ones are split into single tokens on which genderComputer operates iteratively until it provides a certain classification to at least one of them. In the cases in which genderComputer do not provide any certain label for the name, Genderize takes it place.

At the end, three lists are compiled: one for the female names, one for the male ones, and one for the names whose gender has not been identified. Before appending a multiple-words name to one of the lists, an attempt is done in order to try to not include similar occurrences of the same character's name. Therefore, the function `check_list_mwn` is  executed to check whether a name is equal to another by excluding the first word they are (or it is) composed by. For example, John Doe, Mr. John Doe, and Dr. John Doe are likely to be the same character, so only one of these occurrence is kept.

{% embed url="https://github.com/gobbykid/gobbykid-characters-extraction/blob/main/characters_extraction_and_gender_recognition/genderRec.py" %}
The genderRec.py file
{% endembed %}

### Limitations

* The filter used in order to avoid including words that occur only at the beginning of the sentences helps to filter out many exclamations, but has also the disadvantage of potentially excluding the names of marginal characters. We preferred to avoid including a low rate of characters rather than including a potentially high rate of exclamations in our outcomes.
* Trying to exclude different occurrences of the same character's name is very difficult and all but precise. There are uncountable possible configuration of the problem, and many times the same character is called in different ways by different other characters in the book. It would have been possible to refine better the process of comparison between occurrences of similar names, but we found better to stop. To explain why, we present a real case:`['miss betsey', 'betsey trotwood']` is a partial list of names extracted from “David Copperfield”. The issue is that we have only two characters that, nevertheless, have slightly different occurrences of names. It is possible to solve the problem, but in similar cases such as `['miss mary', 'mary ann']`, where we actually have two different characters, since the shape abstractly recall the form `['miss betsey', 'betsey trotwood']`, the information about one character would be lost.
* There are occurrences of names that are extracted, classified, and stored into one of the lists that are not characters names. That means that all the entity recognition functions have recognized those tokens as identifying a “PERSON”. This kind of error varies depending on the book, sometimes some geographical names are included, other times are exclamations or other words that commonly begin with the capital letter.

### Precision and errors quantification

The gender recognition is quite precise. Naturally, there are some exception, especially in cases in which characters are not humans or when names are actually very unlikely nicknames. An example is Bagheera, the tiger of Kipling's Jungle Book, which is actually a male, but is classified as female.

The same cannot be said to the character extraction process. This does not mean that it does not work properly, but that it was not possible to define a clear measure of the precision of the extraction. Whereas for some books the extraction is precise, for other it tends to extract less names that it is supposed to. In other cases, it extracts more. The difficulty stands in the fact that the precision depends on each specific book. For example, a book in which many characters are called with very dissimilar names by different people is more likely to create problems of “over-extraction”. Since we did not found and comprehensive source of data related to the number and the names of all the charcaters (not only the main ones) in the books of our focus, it is impossible for us to quantify the possible error without transforming the process in a close-reading analysis. Also the procedure of finding information about a small set of books and compare them with the results is not useful in this sense, since for the set to be representative it should be possible to know all the different parameters that regulates the way in which all charcaters in our corpus are treated and mentioned by the author.&#x20;

